/*!
* OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/merge","sap/base/strings/capitalize","sap/base/Log","sap/ui/test/Opa5","sap/ui/test/actions/Action","sap/ui/test/actions/Press","sap/ui/test/actions/EnterText","sap/ui/test/matchers/Matcher","sap/ui/test/matchers/MatcherFactory","sap/ui/test/pipelines/MatcherPipeline","sap/ui/test/pipelines/ActionPipeline"],function(m,c,L,O,A,P,E,M,a,b,d){"use strict";function _(){return m.apply(this,[{}].concat(Array.prototype.slice.call(arguments)));}function e(T,v,N){var V=Array.isArray(v)?v:[v];return V.reduce(function(I,w){if(I){return true;}if(w===null||w===undefined){return T===w;}if(T===null||T===undefined){return!!N;}if(typeof w==="function"){if(w===Boolean){return typeof T==="boolean";}if(w===Array){return Array.isArray(T);}if(w===String){return typeof T==="string"||T instanceof String;}if(w===Object){return typeof T==="object"&&T.constructor===Object;}return T instanceof w;}return typeof T===w;},false);}function f(v){var w=Array.prototype.slice.call(arguments,1);return v.reduce(function(x,y){if(e(w[0],y,true)){x.push(w.shift());}else{x.push(undefined);}return x;},[]);}function g(v,T,w){if(T===undefined){T=[];}else if(!Array.isArray(T)){T=[T];}else{T=T.slice(0);}if(Array.isArray(v)){T=w?v.slice(0).concat(T):T.concat(v);}else if(v!==undefined){if(w){T.unshift(v);}else{T.push(v);}}return T;}function h(N,v,R){if(!e(N,Function)){throw new Error("not a function");}if(!e(v,Function)){return N;}if(R){return function(w){return v(w)&&N(w);};}return function(w){v(w);N(w);};}function i(S){if(e(S,u)){return function(){return S.execute();};}if(!e(S,Function)){return function(){O.assert.ok(true,S||"Success");};}return S;}function j(v){var w="";w+=v.controlType||"Control";w+="#"+(v.id||"<undefined>");w+=v.matchers?" with "+(e(v.matchers,Array)?v.matchers.length:1)+" additional matcher(s)":"";w+=" not found";return w;}function k(v,w){if(!v){return null;}var x=v["get"+c(w,0)];if(!x){throw new Error("Object '"+v+"' does not have an aggregation called '"+w+"'");}return x.call(v);}function l(v,T){if(v&&T){t.process({actions:v,control:T});}}function n(v,T){return s.process({matchers:r.getFilteringMatchers({matchers:v}),control:T});}function o(F){var v=F.indexOf(">"),w=v===-1?undefined:F.substring(0,v),x=v===-1?F:F.substring(v+1);return{model:w,path:x};}function p(C){if(e(C,Boolean)){return C?u.Matchers.TRUE:u.Matchers.FALSE;}return u.Matchers.match(C);}var q={autoWait:true,visible:true},r=new a(),s=new b(),t=new d();var u=function(v,w){var x=f([O,Object],v,w);this._oOpaInstance=x[0];return this.options(q,x[1]);};u.defaultOptions=function(v){if(arguments.length>0){q=_(v);}return _(q);};u.create=function(v,I,C,D,w,x,y){var z=f([O,[String,RegExp],String,Boolean,[M,Function,Array,Object],[A,Function,Array],Object],v,I,C,D,w,x,y);return new u(z[0]).hasId(z[1]).hasType(z[2]).isDialogElement(!!z[3]).has(z[4]).do(z[5]).options(z[6]);};u.prototype.options=function(v){this._oOptions=_.apply(this,[this._oOptions].concat(Array.prototype.slice.call(arguments)));return this;};u.prototype.viewId=function(v){return this.options({viewId:v});};u.prototype.viewName=function(v){return this.options({viewName:v});};u.prototype.viewNamespace=function(v){return this.options({viewNamespace:v});};u.prototype.fragmentId=function(F){return this.options({fragmentId:F});};u.prototype.timeout=function(T){return this.options({timeout:T});};u.prototype.debugTimeout=function(D){return this.options({debugTimeout:D});};u.prototype.pollingInterval=function(v){return this.options({pollingInterval:v});};u.prototype.hasId=function(I){return this.options({id:I});};u.prototype.hasType=function(C){return this.options({controlType:C});};u.prototype.has=function(v,R){return this.options({matchers:R?v:g(v,this._oOptions.matchers)});};u.prototype.hasProperties=function(v){return this.has(u.Matchers.properties(v));};u.prototype.hasI18NText=function(v,w,x){return this.has(u.Matchers.i18n.apply(u.Matchers,arguments));};u.prototype.hasAggregation=function(v,w){return this.has(u.Matchers.aggregationMatcher(v,w));};u.prototype.hasAggregationProperties=function(v,w){return this.hasAggregation(v,u.Matchers.properties(w));};u.prototype.hasAggregationLength=function(v,N){return this.has(u.Matchers.aggregationLength(v,N));};u.prototype.hasConditional=function(C,S,v){return this.has(u.Matchers.conditional(C,S,v));};u.prototype.hasSome=function(v){return this.has(u.Matchers.some.apply(u.Matchers,arguments));};u.prototype.mustBeEnabled=function(v){return this.options({enabled:arguments.length?!!v:true});};u.prototype.mustBeVisible=function(v){return this.options({visible:arguments.length?!!v:true});};u.prototype.mustBeReady=function(R){return this.options({autoWait:arguments.length?!!R:true});};u.prototype.isDialogElement=function(D){return this.options({searchOpenDialogs:arguments.length?!!D:true});};u.prototype.check=function(C,R){return this.options({check:R?C:h(C,this._oOptions.check,true)});};u.prototype.checkNumberOfMatches=function(v){return this.check(function(C){if(!C){return v===0;}if(!e(C,Array)){C=[C];}return C.length===v;});};u.prototype.do=function(v,R){if(e(v,u)){L.error("(deprecated) OpaBuilder instance is incorrectly used in .do function - use .success instead");return this.success(v);}return this.options({actions:R?v:g(v,this._oOptions.actions)});};u.prototype.doConditional=function(C,S,v){if(e(S,u)||e(v,u)){L.error("(deprecated) OpaBuilder instance is incorrectly used in .doConditional function - use .success instead");return this.success(u.Actions.conditional(C,S,v));}return this.do(u.Actions.conditional(C,S,v));};u.prototype.doPress=function(I){return this.do(u.Actions.press(I));};u.prototype.doEnterText=function(T,C,K,I){var v=f([String,Boolean,Boolean,String],T,C,K,I);return this.do(u.Actions.enterText(v[0],v[1],v[2],v[3]));};u.prototype.doOnAggregation=function(v,w,x){if(arguments.length<3){x=w;w=undefined;}var F=u.Matchers.filter(w),y=l.bind(this,x);return this.do(function(C){F(k(C,v)).forEach(y);});};u.prototype.doOnChildren=function(C,v,D){var w=f([[M,Function,Array,Object,u],[A,Function,Array],Boolean],C,v,D);C=w[0];v=w[1];D=w[2];if(!e(C,u)){C=new u(this._getOpaInstance()).has(w[0]);}if(v){C.do(v);}return this.do(function(x){var y=C.build(),z=u.Matchers.children(C,D)(x);return u.Actions.executor(y.actions)(z);});};u.prototype.description=function(D){return this.success(D+" - OK").error(D+" - FAILURE");};u.prototype.success=function(S,R){var v=i(S);return this.options({success:R?v:h(v,this._oOptions.success)});};u.prototype.error=function(v,R){if(e(v,String)){return this.options({errorMessage:v});}return this.options({error:R?v:h(v,this._oOptions.error)});};u.prototype.build=function(){if(!this._oOptions.errorMessage){this.error(j(this._oOptions));}return _(this._oOptions);};u.prototype.execute=function(v){if(e(v,O)){this._setOpaInstance(v);}return this._getOpaInstance().waitFor(this.build());};u.prototype._setOpaInstance=function(v){if(!e(v,O)){throw new Error("Opa5 instance expected");}this._oOpaInstance=v;};u.prototype._getOpaInstance=function(){if(!e(this._oOpaInstance,O)){this._setOpaInstance(new O());}return this._oOpaInstance;};u.Matchers={TRUE:function(){return true;},FALSE:function(){return false;},not:function(v){var w=u.Matchers.match(v);return function(C){return!w(C);};},ancestor:function(v,D){return{ancestor:[[v,D]]};},descendant:function(D,v){return{descendant:[[D,v]]};},properties:function(v){return{properties:v};},i18n:function(v,w,x){var y=o(w),z=y.model||"i18n",T=y.path;if(arguments.length>3||(x&&!Array.isArray(x))){x=Array.prototype.slice.call(arguments,2);}return{I18NText:{propertyName:v,modelName:z,key:T,parameters:x}};},resourceBundle:function(v,w,T,x){if(arguments.length>4||(x&&!Array.isArray(x))){x=Array.prototype.slice.call(arguments,3);}return function(C){var R=sap.ui.getCore().getLibraryResourceBundle(w),y=R.getText(T,x),z={};z[v]=y;return n({properties:z},C);};},labelFor:function(v,T,w,x){var y=3,z;if(!e(T,Boolean)){y=2;x=w;w=T;T=false;}if(T){return{labelFor:{propertyName:v,text:w}};}z=o(w);if(arguments.length>y+1||(x&&!Array.isArray(x))){x=Array.prototype.slice.call(arguments,y);}return{labelFor:{propertyName:v,modelName:z.model||"i18n",key:z.path,parameters:x}};},children:function(B,D){var v=f([[M,Function,Array,Object,u],Boolean],B,D);B=v[0];D=v[1];if(!e(B,u)){B=new u().has(B);}return function(C){var w=B.build(),x=O.getPlugin().getMatchingControls(w),y=g(u.Matchers.ancestor(C,D),w.matchers,true);return u.Matchers.filter(y)(x);};},childrenMatcher:function(B,D){var C=u.Matchers.children(B,D);return function(v){return C(v).length>0;};},aggregation:function(v,w){var F=u.Matchers.filter(w);return function(C){return F(k(C,v));};},aggregationMatcher:function(v,w){var x=u.Matchers.aggregation(v,w);return function(C){return x(C).length>0;};},aggregationLength:function(v,w){return{aggregationLengthEquals:{name:v,length:w}};},aggregationAtIndex:function(v,I){return function(C){var w=k(C,v);return w&&I<w.length?w[I]:undefined;};},bindingProperties:function(v,w){return function(C){var x=C.getBindingContext(v),K,V;for(K in w){V=x.getProperty(K);if(V!==w[K]){return false;}}return true;};},bindingPath:function(v,w){var x=o(v);return{bindingPath:{modelName:x.model,path:x.path,propertyPath:w}};},customData:function(C){if(!C){return u.Matchers.TRUE;}return function(v){if(!v||typeof v.data!=="function"){return false;}return Object.keys(C).reduce(function(w,K){return w&&v.data(K)===C[K];},true);};},conditional:function(C,S,v){var w=p(C);return function(x){if(w(x)){return n(S,x);}return v?n(v,x):true;};},focused:function(C){return function(v){var $=v&&v.isA("sap.ui.core.Element")&&v.$();return $&&($.is(":focus")||$.hasClass("sapMFocus")||(C&&$.find(":focus").length>0))||false;};},some:function(v){if(v.length>1||(v&&!Array.isArray(v))){v=Array.prototype.slice.call(arguments,0);}return function(C){var w=false;if(v.some(function(x){w=n(x,C);return w;})){return w;}return false;};},filter:function(v){return function(I){if(I===null||I===undefined){return[];}if(!e(I,Array)){I=[I];}return n(v,I)||[];};},match:function(v){return function(I){if(I===null||I===undefined){return false;}var R=n(v,[I]);return R.length?R[0]:false;};}};u.Actions={press:function(I){return new P({idSuffix:I});},enterText:function(T,C,K,I){return new E({text:T,clearTextFirst:C,keepFocus:K,idSuffix:I});},conditional:function(C,S,v){var w=p(C),x=S,y=v;if(e(S,u)){x=function(){return S.execute();};}if(v&&e(v,u)){y=function(){return v.execute();};}return function(z){if(w(z)){return l(x,z);}else if(y){return l(y,z);}};},executor:function(v){return function(C){if(!C){return;}if(e(C,Array)){return C.map(function(w){return l(v,w);});}return l(v,C);};}};return u;});
