/*
* ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(['./AdaptationController','./FlexUtil','sap/ui/fl/apply/api/FlexRuntimeInfoAPI','sap/ui/mdc/condition/FilterOperatorUtil','sap/base/Log'],function(A,F,a,b,L){"use strict";var o=new A();var S={applyExternalState:function(c,s){return new Promise(function(r,d){var v=this.checkXStateInterface(c);if(!v){d("The control needs to implement IxState");}S.retrieveExternalState(c).then(function(C){var e=C.hasOwnProperty("sorters");var f=C.hasOwnProperty("filter");var i=C.hasOwnProperty("items");var g,h,I,j=[];if(e&&s.sorters){g=o.createSortChanges(s.sorters,false);}if(f&&s.filter){this.checkConditionOperatorSanity(s.filter);h=o.createConditionChanges(s.filter);}if(i&&s.items&&s.items.length>0){I=o.createItemChanges(s.items);}Promise.all([g,h,I]).then(function(R){R.forEach(function(k){if(k&&k.length>0){j=j.concat(k);}});r(F.handleChanges(j));});}.bind(this),d);}.bind(this));},retrieveExternalState:function(c){return new Promise(function(r,d){o.setAdaptationControl(c);o.setStateRetriever(c.getCurrentState);o.setItemConfig(c.getAdaptationConfigAttribute("itemConfig"));var v=this.checkXStateInterface(c);if(!v){d("The control needs to implement then interface IxState.");}c.initialized().then(function(){a.waitForChanges({element:c}).then(function(){r(c.getCurrentState());});});}.bind(this));},checkXStateInterface:function(c){if(!c){return false;}if(!a.isFlexSupported({element:c})){return false;}if(!c.isA("sap.ui.mdc.IxState")){return false;}return true;},checkConditionOperatorSanity:function(c){for(var f in c){var C=c[f];for(var i=0;i<C.length;i++){var d=C[i];var O=d.operator;if(!b.getOperator(O)){C.splice(i,1);if(c[f].length==0){delete c[f];}L.warning("The provided conditions for field '"+f+"' contain unsupported operators - these conditions will be neglected.");}}}}};return S;});
