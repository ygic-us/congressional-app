/*
* ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/merge"],function(m){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var P={createP13nPopover:function(p,d){return new Promise(function(a,b){sap.ui.require(["sap/m/ResponsivePopover"],function(R){P["_checkSettings"](p,d,b);var o=new R({title:d.title,horizontalScrolling:d.hasOwnProperty("horizontalScrolling")?d.horizontalScrolling:false,verticalScrolling:d.hasOwnProperty("verticalScrolling")?d.verticalScrolling:false,contentWidth:d.contentWidth?d.contentWidth:"24rem",resizable:d.hasOwnProperty("resizable")?d.resizable:true,contentHeight:d.contentHeight?d.contentHeight:"35rem",placement:d.placement?d.placement:"Bottom",content:p,afterClose:d.afterClose?d.afterClose:function(){}});a(o);},b);});},createP13nDialog:function(p,d){return new Promise(function(a,b){P["_checkSettings"](p,d,b);var i=d.id;sap.ui.require(["sap/m/Dialog","sap/m/Button"],function(D,B){var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var c=new D(i,{title:d.title,horizontalScrolling:d.hasOwnProperty("horizontalScrolling")?d.horizontalScrolling:false,verticalScrolling:d.hasOwnProperty("verticalScrolling")?d.verticalScrolling:true,contentWidth:d.contentWidth?d.contentWidth:"40rem",contentHeight:d.contentHeight?d.contentHeight:"55rem",draggable:true,resizable:true,stretch:"{device>/system/phone}",content:p,buttons:[new B(i?i+"-confirmBtn":undefined,{text:d.confirm&&d.confirm.text?d.confirm.text:R.getText("p13nDialog.OK"),type:"Emphasized",press:function(){if(d.confirm&&d.confirm.handler){d.confirm.handler.apply(c,arguments);}}}),new B(i?i+"-cancelBtn":undefined,{text:R.getText("p13nDialog.CANCEL"),press:function(){d.cancel.apply(c,arguments);}})]});var A=d.additionalButtons;if(A instanceof Array){A.forEach(function(o){if(!o.isA("sap.m.Button")){b("Please only provide sap.m.Button instances as 'additionalButtons'");}c.addButton(o);});}a(c);},b);});},prepareP13nData:function(c,i,I,p){I=I?I:[];var a=[],b={};var d=c.items||[];var s=c.sorters||[];var e=this.arrayToMap(d);var E=this.arrayToMap(s);var f=c.filter||{};i.forEach(function(o){var g={};if(P._isExcludeProperty(o,I)){return;}var k=o.name;var h=e[k];g.selected=h?true:false;g.position=h?h.position:-1;g=m(g,o,h);g.label=o.label||o.name;g.tooltip=o.tooltip?o.tooltip:o.label;g.visibleInDialog=o.hasOwnProperty("visibleInDialog")?o.visibleInDialog:true;if(p=="Sort"){g.isSorted=E[k]?true:false;g.sortPosition=E[k]?E[k].position:-1;g.descending=E[k]?E[k].descending:false;}if(c.filter){var j=f[k];g.isFiltered=j&&j.length>0?true:false;}g.group=g.group?g.group:"BASIC";b[g.group]=b[g.group]?b[g.group]:[];b[g.group].push(g);a.push(g);});if(p){this._sortP13nData(p,a);}return{items:a,itemsGrouped:this._builtGroupStructure(b)};},_sortP13nData:function(p,i){var a=this._getSortAttributes()[p];var s=a.position;var S=a.visible;var l=sap.ui.getCore().getConfiguration().getLocale().toString();var c=window.Intl.Collator(l,{});i.sort(function(f,F){if(f[S]&&F[S]){return(f[s]||0)-(F[s]||0);}else if(f[S]){return-1;}else if(F[S]){return 1;}else if(!f[S]&&!F[S]){return c.compare(f.label,F.label);}});},_getSortAttributes:function(){return{Item:{position:"position",visible:"selected"},Sort:{position:"sortPosition",visible:"isSorted"},Filter:{position:undefined,visible:undefined}};},_builtGroupStructure:function(i){var g=[];Object.keys(i).forEach(function(G){this._sortP13nData("Filter",i[G]);g.push({group:G,groupLabel:i[G][0].groupLabel||r.getText("p13nDialog.FILTER_DEFAULT_GROUP"),groupVisible:true,items:i[G]});}.bind(this));return g;},_isExcludeProperty:function(p,i){return i.some(function(k){var I=k.ignoreKey;var v=k.ignoreValue;return p[I]===v;});},_checkSettings:function(p,d,o){if(!d){o("Please provide a settings object for Popover creation");}if(!d.title){o("Please provide a title in the settings object for Popover creation");}},arrayToMap:function(a){return a.reduce(function(M,p,i){M[p.name]=p;M[p.name].position=i;return M;},{});}};return P;});
