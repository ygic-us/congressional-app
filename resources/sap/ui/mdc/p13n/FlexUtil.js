/*
* ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(['sap/base/util/array/diff','sap/base/util/deepEqual','sap/ui/mdc/condition/FilterOperatorUtil'],function(d,a,F){"use strict";var b={getArrayDeltaChanges:function(e,c,s,C,m,i){var I=m["add"];var r=m["remove"];var M=m["move"];var R=d(e,c,s);var f=function(o,A){return A.filter(function(E){return E&&(E.name===o.name);})[0];};var g=function(P){var o={name:P.name};if(P.index>=0&&!i){o.index=P.index;}if(P.role){o.role=P.role;}if(P.hasOwnProperty("descending")){o.descending=P.descending==="true"||P.descending===true;}return o;};var h=[];var p=e.slice(0);R.forEach(function(o){if(o.type==="delete"&&p[o.index]===undefined){p.splice(o.index,1);return;}var P,E,l;if(o.type==="insert"){E=f(c[o.index],p);if(E){E.index=p.indexOf(E);p.splice(E.index,1,undefined);h.push(this.createAddRemoveChange(C,r,g(E)));}}P=o.type==="delete"?p[o.index]:c[o.index];P.index=o.index;if(o.type==="delete"){p.splice(P.index,1);}else{p.splice(P.index,0,P);}if(M){l=h.length;if(l){E=h[l-1];E=E?E.changeSpecificData.content:undefined;}if(E&&E.name===P.name&&o.index!=E.index){h.pop();h.push(this.createMoveChange(E.id,E.name,o.index,M,C,M!=="moveSort"));return;}}h.push(this.createAddRemoveChange(C,o.type==="delete"?r:I,g(P)));}.bind(this));return h;},getConditionDeltaChanges:function(f,o,O,c){var C,e=[];var g=o;var s=O?O:[];if(a(g,s)){return e;}var r=function(g,s){var R;do{R=false;for(var i=0;i<g.length;i++){var n=F.indexOfCondition(g[i],s);if(n>-1){g.splice(i,1);s.splice(n,1);R=true;break;}}}while(R);};r(g,s);if((g.length>0)||(s.length>0)){s.forEach(function(h){C=b.createConditionChange("removeCondition",c,f,h);if(C){e.push(C);}});g.forEach(function(h){C=b.createConditionChange("addCondition",c,f,h);if(C){e.push(C);}});}return e;},createAddRemoveChange:function(c,o,C){var A={selectorElement:c,changeSpecificData:{changeType:o,content:C}};return A;},createMoveChange:function(i,p,n,m,c,P){var M={selectorElement:c,changeSpecificData:{changeType:m,content:{id:i,name:p,index:n}}};if(!P){delete M.changeSpecificData.content.id;}return M;},createConditionChange:function(c,C,f,o){var e={selectorElement:C,changeSpecificData:{changeType:c,content:{name:f,condition:o}}};return e;},handleChanges:function(c){return new Promise(function(r,e){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(C){C.add({changes:c}).then(function(D){r(D);},e);});});}};return b;});
