/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/model/Filter","sap/base/Log"],function(F,a,L){"use strict";var b={createConditionTypesMapFromFilterBar:function(c,f){var r={};for(var s in c){if(f){var p=f._getPropertyByName(s);var d=p&&p.typeConfig&&p.typeConfig.typeInstance;r[s]={type:d};}}return r;},createFilters:function(c,C,f){var i,l,d,o=[],O,e,n,g,A;var h=function(e,r,P){var v="L1";var S,N,t;if(e.sPath&&e.sPath.indexOf(P)>-1){S=e.sPath.split(P);if(S.length===2){N=S[0];t=S[1];e.sPath=v+"/"+t;return{path:N,operator:r,variable:v};}else{throw new Error("FilterConverter: not supported binding "+e.sPath);}}return false;};var k=function(e){var r=h(e,sap.ui.model.FilterOperator.Any,"*/");if(r){return r;}else{return h(e,sap.ui.model.FilterOperator.All,"+/");}};for(var s in c){l=[];d=[];A=null;var m=c[s];for(i=0;i<m.length;i++){g=m[i];O=F.getOperator(g.operator);if(!O){continue;}var D;if(C){if(C[s]){D=C[s].type;if(!D){L.warning("FilterConverter","Not able to retrieve the type of path '"+s+"!");}}}try{e=O.getModelFilter(g,s,D);}catch(p){L.error("FilterConverter","Not able to convert the condition for path '"+s+"' into a filter! The type is missing!");continue;}if(f){e=f(g,s,D,e);if(!e){continue;}}if(!O.exclude){if(e.sPath==="$search"){continue;}var $=/^\*(.+)\*$/.exec(e.sPath);if($){var q=$[1].split(',');for(var j=0;j<q.length;j++){l.push(new a(q[j],e.sOperator,e.oValue1));}continue;}A=k(e);l.push(e);}else{A=k(e);d.push(e);}}e=undefined;if(l.length===1){e=l[0];}else if(l.length>1){e=new a({filters:l,and:false});}if(e){d.unshift(e);}n=undefined;if(d.length===1){n=d[0];}else if(d.length>1){n=new a({filters:d,and:true});}if(A){A.condition=n;n=new a(A);}if(n){o.push(n);}}if(o.length===1){e=o[0];}else if(o.length>1){e=new a({filters:o,and:true});}else{e=null;}L.info("FilterConverter",b.prettyPrintFilters(e));return e;},prettyPrintFilters:function(f){var r;if(!f){return"";}if(f._bMultiFilter){r="";var A=f.bAnd;f.aFilters.forEach(function(f,i,c){r+=b.prettyPrintFilters(f);if(c.length-1!=i){r+=A?" and ":" or ";}},this);return"("+r+")";}else{if(f.sOperator===sap.ui.model.FilterOperator.Any||f.sOperator===sap.ui.model.FilterOperator.All){r=f.sPath+" "+f.sOperator+" "+b.prettyPrintFilters(f.oCondition);}else{r=f.sPath+" "+f.sOperator+" '"+f.oValue1+"'";if(f.sOperator==="BT"){r+="...'"+f.oValue2+"'";}}return r;}}};return b;},true);
