/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/util/loadModules",'sap/base/util/merge'],function(l,m){"use strict";var A;var F;var a={};a.retrieveAdaptationController=function(){if(!this.getProperty("adaptationConfig")){throw new Error("Please provide an adaptation config for this control before instantiating an adaptation controller.");}var o=function(){if(!this._oAdaptationController){this._oAdaptationController=new A(Object.assign({stateRetriever:function(c,d){return this.getCurrentState();},adaptationControl:this,afterChangesCreated:function(b,c){F.handleChanges(c);}},this.getProperty("adaptationConfig")));}return this._oAdaptationController;};return l(["sap/ui/mdc/p13n/AdaptationController","sap/ui/mdc/p13n/FlexUtil"]).then(function(b){A=b[0];F=b[1];}).then(function(){if(!this.bIsDestroyed){return o.call(this);}}.bind(this));};a.getAdaptationController=function(){if(!this._oAdaptationController){throw new Error("An adaptation controller instance is not (yet) available. You must call retrieveAdaptationController before calling getAdaptationController.");}return this._oAdaptationController;};a.getAdaptationConfigAttribute=function(s){var o=this.getAdaptationConfig();if(!o){throw new Error("Please provide an adaptation config for this control before calling getAdaptationConfigAttribute.");}return o&&o[s];};a.enhanceAdaptationConfig=function(d){var n=m(this.getAdaptationConfig(),d);if(this._oAdaptationController){Object.keys(d).forEach(function(k){this._oAdaptationController.setProperty(k,n[k]);}.bind(this));}this.setProperty("adaptationConfig",n);return this;};a.retrieveInbuiltFilter=function(r,b){return new Promise(function(c,d){sap.ui.require(["sap/ui/mdc/filterbar/p13n/AdaptationFilterBar"],function(e){if(!this._oP13nFilter){this._oP13nFilter=new e(this.getId()+"-p13nFilter",{adaptationControl:this,advancedMode:b,filterConditions:this.getFilterConditions()});if(r instanceof Function){r.call(this,this._oP13nFilter);}this.enhanceAdaptationConfig({filterConfig:{initializeControl:this._oP13nFilter.createFilterFields}});this.addDependent(this._oP13nFilter);c(this._oP13nFilter);}else{c(this._oP13nFilter);}}.bind(this));}.bind(this));};a.getRTASettingsActionHandler=function(p,P){return new Promise(function(r,b){this.retrieveAdaptationController().then(function(o){var c=o.getLiveMode();if(c){o.setLiveMode(false);}var R=o.getAfterChangesCreated();var e=function(E){var C=E.getParameter("container");C.isPopupAdaptationAllowed=function(){return false;};C.addStyleClass(p.styleClass);};o.attachEvent("beforeP13nContainerOpens",e);var t=[];o.setAfterChangesCreated(function(d,C,s){if(d.sP13nType==="Filter"){if(s==="Item"){t=C;}else if(s==="Value"){r(t.concat(C));t=[];}}else{r(C);}});var f=function(E){var s=E.getParameter("reason");if(s=="Cancel"){r([]);}if(c){o.setLiveMode(c);}o._executeAfterAsyncActions(function(d){setTimeout(function(){o.setAfterChangesCreated(R);},0);});o.detachEvent("beforeP13nContainerOpens",e);o.detachEvent("afterP13nContainerCloses",f);};o.attachEvent("afterP13nContainerCloses",f);o.showP13n(this,P);});}.bind(this));};a.exit=function(e){return function(){if(this._oAdaptationController){this._oAdaptationController.destroy();this._oAdaptationController=null;}if(e){e.apply(this,arguments);}};};return function(){this.retrieveAdaptationController=a.retrieveAdaptationController;this.getAdaptationController=a.getAdaptationController;this.enhanceAdaptationConfig=a.enhanceAdaptationConfig;this.getAdaptationConfigAttribute=a.getAdaptationConfigAttribute;this.getRTASettingsActionHandler=a.getRTASettingsActionHandler;this.retrieveInbuiltFilter=a.retrieveInbuiltFilter;this.exit=a.exit(this.exit);};},true);
