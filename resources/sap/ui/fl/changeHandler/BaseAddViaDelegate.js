/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/ui/fl/apply/api/DelegateMediatorAPI","sap/base/util/merge","sap/base/util/ObjectPath"],function(B,D,m,O){"use strict";function i(f){return typeof f==="function";}function g(c){if(c.modelType){return c.modelType;}else if(c.oDataServiceVersion){return"sap.ui.model.odata.v2.ODataModel";}}var a={createAddViaDelegateChangeHandler:function(A){function b(n){return n+A.fieldSuffix;}function s(C){if(i(A.skipCreateLabel)){return!!A.skipCreateLabel({changeDefinition:C});}return!!A.skipCreateLabel;}function c(C){if(i(A.skipCreateLayout)){return!!A.skipCreateLayout({changeDefinition:C});}return!!A.skipCreateLayout;}function d(C,f,o){var h=m({},f);h.fieldSelector.id=b(h.fieldSelector.id);return o.createControlForProperty(h).then(function(S){if(s(C)){return S;}var n=f.modifier.getId(S.control);f.labelFor=n;return o.createLabel(f).then(function(l){return{label:l,control:S.control,valueHelp:S.valueHelp};});});}function e(C,f,p){var h=m({aggregationName:A.aggregationName,payload:f.payload||{}},p);var o=f.instance;return Promise.resolve().then(function(){if(i(o.createLayout)&&!c(C)){return o.createLayout(h);}}).then(function(l){if(O.get("control",l)){l.layoutControl=true;return l;}return d(C,h,o);});}return{applyChange:function(C,o,p){var f=C.getDefinition();var h=p.appComponent;var j=f.content;var F=j.newFieldSelector;var k={appComponent:p.appComponent,view:p.view,fieldSelector:F,bindingPath:j.bindingPath,modifier:p.modifier,element:o};if(p.modifier.bySelector(F,h)){return B.markAsNotApplicable("Control to be created already exists:"+(F.id||F),true);}var r={newFieldSelector:F};C.setRevertData(r);var M=g(j);return D.getDelegateForControl({control:o,modifier:p.modifier,modelType:M,supportsDefault:A.supportsDefault}).then(function(l){return e(f,l,k);}).then(function(I){var l=m({},{control:o,innerControls:I,change:C},p);A.addProperty(l);if(I.valueHelp){var v=p.modifier.getSelector(p.modifier.getId(I.valueHelp),h);r.valueHelpSelector=v;}});},revertChange:function(C,o,p){var f=p.appComponent;var M=p.modifier;var F=C.getRevertData().newFieldSelector;var v=C.getRevertData().valueHelpSelector;var n=M.bySelector(F,f);var P=C.getDependentControl(A.parentAlias,p)||o;M.removeAggregation(P,A.aggregationName,n);M.destroy(n);if(v){var V=M.bySelector(v,f);M.removeAggregation(P,"dependents",V);M.destroy(V);}var h=m({},{control:o,change:C},p);if(i(A.revertAdditionalControls)){A.revertAdditionalControls(h);}C.resetRevertData();return true;},completeChangeContent:function(C,S,p){var o=p.appComponent;var f=C.getDefinition();if(!f.content){f.content={};}if(S.parentId){if(i(A.mapParentIdIntoChange)){A.mapParentIdIntoChange(C,S,p);}else{C.addDependentControl(S.parentId,A.parentAlias,p);}}else{throw new Error("mSpecificChangeInfo.parentId attribute required");}if(S.bindingPath){f.content.bindingPath=S.bindingPath;}else{throw new Error("mSpecificChangeInfo.bindingPath attribute required");}if(S.newControlId){f.content.newFieldSelector=p.modifier.getSelector(S.newControlId,o);}else{throw new Error("mSpecificChangeInfo.newControlId attribute required");}if(S.index===undefined){throw new Error("mSpecificChangeInfo.targetIndex attribute required");}else{f.content.newFieldIndex=S.index;}if(S.oDataServiceVersion){f.content.oDataServiceVersion=S.oDataServiceVersion;}if(S.modelType&&A.supportsDefault){f.content.modelType=S.modelType;}}};}};return a;});
