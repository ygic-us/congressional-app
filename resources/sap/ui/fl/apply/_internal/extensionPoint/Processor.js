/*!
* OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/changes/ExtensionPointState","sap/ui/fl/Utils","sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/util/merge"],function(A,F,E,U,J,m){"use strict";var P={oExtensionPointRegistry:undefined,oRegistryPromise:Promise.resolve(),registerExtensionPoint:function(e){P.oRegistryPromise=P.oRegistryPromise.then(function(){return new Promise(function(r,a){if(P.oExtensionPointRegistry){P.oExtensionPointRegistry.registerExtensionPoint(e);return r();}else if(sap.ui.getCore().getConfiguration().getDesignMode()){sap.ui.require(["sap/ui/fl/write/_internal/extensionPoint/Registry"],function(b){P.oExtensionPointRegistry=b;b.registerExtensionPoint(e);r();},function(o){a(o);});}else{r();}});});return P.oRegistryPromise;},createDefaultContent:function(e,c){if(c.length===0){return e.createDefault().then(function(C){C.forEach(function(n,i){J.insertAggregation(e.targetControl,e.aggregationName,n,e.index+i,e.view);});e.ready(C);return C;});}return Promise.resolve([]);},addDefaultContentToExtensionPointInfo:function(e,c){e.defaultContent=e.defaultContent.concat(c);},applyExtensionPoint:function(e){var a=U.getAppComponentForControl(e.targetControl);var p={};var b=m({defaultContent:[]},e);p.appComponent=a;p.modifier=J;p.viewId=e.view.getId();p.componentId=a.getId();var o=P.registerExtensionPoint(b).then(F.initialize.bind(F,p)).then(E.enhanceExtensionPointChanges.bind(E,p,b)).then(P.createDefaultContent.bind(this,e)).then(P.addDefaultContentToExtensionPointInfo.bind(this,b));A.addPreConditionForInitialChangeApplying(o);return o;}};return P;});
