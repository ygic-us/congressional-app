/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","../UIArea",'sap/base/util/extend',"sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(D,U,e,q){"use strict";var a={},d=null,o=null,v=null,V=[],b=[],c=null,$,f,g,C,t,l={},h;function j(i,S){if(!i){return;}if(i.addStyleClass){i.addStyleClass(S);}else{i.$().addClass(S);}}function r(i,S){if(!i){return;}if(i.removeStyleClass){i.removeStyleClass(S);}else{i.$().removeClass(S);}}function k(i,F){var G=q(i.target).control(0,true);if(!G){return;}var N=q.Event(null,i);N.type=F;G.getUIArea()._handleEvent(N);}function m(i){return!i.disabled&&/^(input|textarea)$/.test(i.localName);}function s(d,i){if(D.browser.msie||!d||!d.getDragGhost){return;}var F=d.getDragGhost();if(!F){return;}if(!g){g=q('<div class="sapUiDnDGhostContainer"></div>');q(document.body).append(g);}g.append(F);window.setTimeout(function(){g.empty();},0);var O=i.originalEvent;O.dataTransfer.setDragImage(F,O.offsetX,O.offsetY);}function n(i){var F={},I,G=i.originalEvent.dataTransfer,H=function(T,J){if(G&&T=="text"||(D.browser!="msie"&&D.browser!="edge")){G.setData(T,J);}};return{setData:function(K,J){J=""+J;F[K]=J;H(K,J);},getData:function(K){return F[K];},setTextData:function(J){J=""+J;F["text/plain"]=J;F["text"]=J;H("text/plain",J);H("text",J);},getTextData:function(){return F["text/plain"];},setComplexData:function(K,J){F[K]=J;},getComplexData:function(K){return F[K];},getIndicator:function(){return $&&$[0];},setIndicatorConfig:function(J){I=J;},getIndicatorConfig:function(J){return I;},getDragControl:function(){return d;},getDropControl:function(){return v;},setDropControl:function(J){v=J;},getDropInfo:function(){return b[0]||null;},getDropPosition:function(){return C;}};}function p(i){d=o=v=c=null;C="";V=[];b=[];}function u(){if($){return $;}if(!D.browser.msie){f=q("<div class='sapUiDnDIndicatorWrapper'></div>");}$=q("<div class='sapUiDnDIndicator'></div>");if(!f){q(sap.ui.getCore().getStaticAreaRef()).append($);}else{q(sap.ui.getCore().getStaticAreaRef()).append(f);$.appendTo(f);}return $;}function w(){if($){$.removeAttr("style").hide();l={};}}function x(i,F,G,H){if(!F){return;}var I=i.dragSession&&i.dragSession.getIndicatorConfig(),J=F.getBoundingClientRect(),P=window.pageYOffset,K=window.pageXOffset,L=u(),R,S={},M={top:J.top+P,bottom:J.bottom+P,left:J.left+K,right:J.right+K,width:J.width,height:J.height};if(!G||G=="On"){R="On";H="";}else if(H=="Horizontal"){var N=i.pageX-M.left;S.height=M.height;S.top=M.top;if(G=="Between"){S.width="";if(N<M.width*0.5){R="Before";S.left=M.left;}else{R="After";S.left=M.right;}}else if(G=="OnOrBetween"){if(N<M.width*0.25){R="Before";S.left=M.left;S.width="";}else if(N>M.width*0.75){R="After";S.left=M.right;S.width="";}else{R="On";}}if(R!="On"&&sap.ui.getCore().getConfiguration().getRTL()){R=(R=="After")?"Before":"After";}}else{var O=i.pageY-M.top;S.width=M.width;S.left=M.left;if(G=="Between"){S.height="";if(O<M.height*0.5){R="Before";S.top=M.top;}else{R="After";S.top=M.bottom;}}else if(G=="OnOrBetween"){if(O<M.height*0.25){R="Before";S.top=M.top;S.height="";}else if(O>M.height*0.75){R="After";S.top=M.bottom;S.height="";}else{R="On";}}}if(I&&I.display=="none"){return R;}if(R=="On"){S.top=M.top;S.left=M.left;S.width=M.width;S.height=M.height;G=R;}else{G="Between";}if(l.top!=S.top||l.left!=S.left||l.width!=S.width||l.height!=S.height){L.attr("data-drop-layout",H);L.attr("data-drop-position",G);L.css(e(S,I)).show();l=S;}return R;}function y(i){var P=i.getParent(),S=(i.getDragDropConfig)?i.getDragDropConfig():[],F=(P&&P.getDragDropConfig)?P.getDragDropConfig():[];return S.concat(F);}function z(d){var i=y(d);return i.filter(function(F){return F.isDraggable(d);});}function A(o,i,F){var G=y(o);i=i||[];return G.filter(function(H){return!H.isA("sap.ui.core.dnd.IDragInfo");}).concat(i).filter(function(H){if(!H.isDroppable(o,F)){return false;}var I=H.getGroupName();if(!I){return true;}return i.some(function(J){return J.getGroupName()==I;});});}function B(i,F){i.preventDefault();var G=F.getDropEffect().toLowerCase();i.originalEvent.dataTransfer.dropEffect=G;}function E(i,F,v){var T=F.getTargetAggregation();if(!T){return x(i,v.getDomRef());}var G;if(i.getMark("DragWithin")==T){G=v.getDomRefForSetting(T);}G=G||v.getDomRef();return x(i,G,F.getDropPosition(true),F.getDropLayout(true));}a.preprocessEvent=function(i){if(c&&i.type.indexOf("dr")==0){i.dragSession=c;}var F="onbefore"+i.type;if(a[F]){a[F](i);}};a.postprocessEvent=function(i){var F="onafter"+i.type;if(a[F]){a[F](i);}};a.onbeforemousedown=function(i){if((D.browser.msie||D.browser.firefox||D.browser.edge)&&m(i.target)){h=q(i.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0];}};a.onbeforemouseup=function(i){if(h){h.draggable=true;h=null;}};a.onbeforedragstart=function(i){if(!i.target.draggable){return;}if(m(document.activeElement)){i.target.getAttribute("data-sap-ui-draggable")&&i.preventDefault();return;}d=q(i.target).control(0,true);if(!d){return;}V=z(d);if(!V.length){return;}if(D.browser.firefox&&i.originalEvent.dataTransfer.types.length===0){i.originalEvent.dataTransfer.setData("ui5/dummyDataForFirefox","data");}i.dragSession=c=n(i);};a.onafterdragstart=function(i){if(!V.length||i.isDefaultPrevented()){p();return;}V=i.isMarked("NonDraggable")?[]:V.filter(function(F){return F.fireDragStart(i);});if(!V.length){i.preventDefault();p();return;}s(d,i);j(d,"sapUiDnDDragging");q("html").addClass("sapUiDnDNoScrolling");};a.onbeforedragenter=function(F){var G=q(F.target).control(0,true);if(G&&o===G){F.setMark("DragWithin","SameControl");}else{t=Date.now();o=G;}var H=[];v=G;for(var i=0;i<20&&v;i++,v=v.getParent()){H=A(v,V,F);if(H.length){break;}}if(F.getMark("DragWithin")!="SameControl"){b=H;if(c){c.setIndicatorConfig(null);}}if(!b.length){v=null;}else if(!c){F.dragSession=c=n(F);}};a.onafterdragenter=function(i){if(!v||i.isMarked("NonDroppable")){b=[];}else if(i.getMark("DragWithin")!="SameControl"){b=b.filter(function(G){return G.fireDragEnter(i);});}var F=b[0];if(!F||F.getDropEffect()=="None"){w();C="";}else{B(i,F);C=E(i,F,v);}};a.onbeforedragover=function(i){var F=Date.now();if(F-t>=1000){k(i,"longdragover");t=F;}};a.onafterdragover=function(i){var F=b[0];if(!F||F.getDropEffect()=="None"){return;}b.forEach(function(G){G.fireDragOver(i);});B(i,F);if(F&&F.getDropPosition(true)=="On"){return;}C=E(i,F,v);};a.onbeforedrop=function(i){if(b.length){i.preventDefault();}};a.onafterdrop=function(i){b.forEach(function(F){F.fireDrop(i);});this.iDragEndTimer=window.requestAnimationFrame(this.onafterdragend.bind(this,i));};a.onafterdragend=function(i){this.iDragEndTimer=window.cancelAnimationFrame(this.iDragEndTimer);V.forEach(function(F){F.fireDragEnd(i);});r(d,"sapUiDnDDragging");q("html").removeClass("sapUiDnDNoScrolling");w();p();};U.addEventPreprocessor(a.preprocessEvent);U.addEventPostprocessor(a.postprocessEvent);return a;},true);
